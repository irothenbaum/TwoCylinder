!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("twocylinder",[],e):"object"==typeof exports?exports.twocylinder=e():t.twocylinder=e()}(window,function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=13)}([function(t,e,n){var o=n(7);Constants={TAU:2*Math.PI},Functions={disjoinArray2FromArray1:function(t,e,n){var o,i;if(e.length)for(o=0;o<e.length;o++)for(i=0;i<t.length;i++)if(t[i].__id===e[o].__id){"function"==typeof n&&n(t[i]),delete t[i].__id,t.splice(i,1);break}},clone:function(t){return Object.assign(Object.create(Object.getPrototypeOf(t)),t)}},Geometry={boxCollidesBox:function(t,e){var n=t.origin_x<=e.origin_x&&t.origin_x+t.width>e.origin_x||e.origin_x<=t.origin_x&&e.origin_x+e.width>t.origin_x,o=t.origin_y<=e.origin_y&&t.origin_y+t.height>e.origin_y||e.origin_y<=t.origin_y&&e.origin_y+e.height>t.origin_y;return n&&o},boxCollidesCircle:function(t,e){var n={x:t.origin_x,y:t.origin_y},o={x:t.origin_x+t.width,y:t.origin_y},i={x:t.origin_x+t.width,y:t.origin_y+t.height},r={x:t.origin_x,y:t.origin_y+t.height},u=[n,o],c=[o,i],l=[i,r],s=[r,n];return Geometry.pointCollidesBox(e,t)||Geometry.lineCollidesCircle(u,e,!0)||Geometry.lineCollidesCircle(c,e,!0)||Geometry.lineCollidesCircle(l,e,!0)||Geometry.lineCollidesCircle(s,e,!0)},boxCollidesPoint:function(t,e){return e.x>=t.origin_x&&t.origin_x+t.width>=e.x&&e.y>=t.origin_y&&t.origin_y+t.height>=e.y},circleCollidesCircle:function(t,e){return this.distanceToPoint(t,e)<t.radius+e.radius},circleCollidesBox:function(t,e){return Geometry.boxCollidesCircle(e,t)},circleCollidesLine:function(t,e,n){return Geometry.lineCollidesCircle(e,cricle,n)},circleCollidesPoint:function(t,e){return Geometry.pointCollidesCircle(e,t)},lineIntersectsCircle:function(t,e,n){var o=t[0],i=t[1],r=Math.sqrt(Math.pow(o.x-i.x,2)+Math.pow(o.y-i.y,2)),u=(o.x-i.x)/r,c=(o.y-i.y)/r,l=u*(e.x-i.x)+c*(e.y-i.y),s={x:l*u+i.x,y:l*c+i.y},a=Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2)),f=[];if(a<e.radius){var y=Math.sqrt(Math.pow(e.radius,2)-Math.pow(a,2)),p={x:(l-y)*u+i.x,y:(l-y)*c+i.y};n&&!Geometry.lineCollidesPoint(t,p,!0)||f.push(p);var _={x:(l+y)*u+i.x,y:(l+y)*c+i.y};n&&!Geometry.lineCollidesPoint(t,_,!0)||f.push(_)}else parseInt(a)===parseInt(e.radius)&&(n&&!Geometry.lineCollidesPoint(t,s,!0)||f.push(s));return f},lineCollidesCircle:function(t,e,n){return Geometry.lineIntersectsCircle(t,e,n).length>0||Geometry.pointCollidesCircle(t[0],e)},lineCollidesPoint:function(t,e,n){var o=Geometry.angleToPoint(t[0],e),i=Geometry.angleToPoint(t[1],e),r=o===i;return r||(r=o===(i=Geometry.angleToPoint(e,t[1]))),r&&n&&(r=Geometry.distanceToPoint(t[0],e)+Geometry.distanceToPoint(t[1],e)===Geometry.distanceToPoint(t[0],t[1])),r},pointCollidesCircle:function(t,e){return Geometry.distanceToPoint(t,e)<=e.radius},pointCollidesBox:function(t,e){return Geometry.boxCollidesPoint(e,t)},pointCollidesPoint:function(t,e){return t.x===e.x&&t.y===e.y},pointCollidesLine:function(t,e){return Geometry.lineCollidesPoint(e,t)},distanceToPoint:function(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)},angleToPoint:function(t,e,n){var o=Math.atan2(e.y-t.y,e.x-t.x);return n?180*o/Math.PI:o},pointToPoint:function(t,e){return new o({speed:Geometry.distanceToPoint(t,e),direction:Geometry.angleToPoint(t,e)})},pointFromVector:function(t,e){return{x:t.x+Math.cos(e.getDirection())*e.getSpeed(),y:t.y+Math.sin(e.getDirection())*e.getSpeed()}},getRandomDirection:function(){return 2*Math.random()*Math.PI}},t.exports={Geometry:Geometry,Functions:Functions,Constants:Constants}},function(t,e){t.exports=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(1),s=n(3),a=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=r(this,u(e).call(this,t))).setBoundingBox(t.bounding),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"collides",value:function(t){return this._bounding&&this._bounding.collides(t)}},{key:"getBounding",value:function(){return this._bounding}},{key:"setBounding",value:function(t){if(!(t||t instanceof s))throw"All objects must have a true bounding";return this._bounding=t}}]),e}();t.exports=a},function(t,e,n){function o(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function u(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var s=n(1),a=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=u(this,c(e).call(this,t))).rotation=0,Object.entries(t).forEach(function(t){n[t[0]]=t[1]}),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(e,s),function(t,e,n){e&&r(t.prototype,e),n&&r(t,n)}(e,[{key:"getCenter",value:function(){return{x:null,y:null}}},{key:"setCenter",value:function(t){return null}},{key:"setCenterWithinContainer",value:function(t,e){return this.setCenter(t)}},{key:"getContainingRectangle",value:function(){return{origin_x:null,origin_y:null,width:null,height:null}}},{key:"getRotation",value:function(){return null}},{key:"setRotation",value:function(t){this.rotation=t}},{key:"updateBounding",value:function(t,e){var n=this;return"object"===i(t)?Object.entries(t).forEach(function(t){n.updateBounding.apply(n,o(t))}):this[t]=e,this}},{key:"collides",value:function(t){return!1}}]),e}();t.exports=a},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(3),s=n(0).Geometry,a=n(6),f=n(5),y=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,u(e).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"getCenter",value:function(){return{x:this.x,y:this.y}}},{key:"setCenter",value:function(t){this.x=t.x,this.y=t.y}},{key:"getContainingRectangle",value:function(){return{origin_x:this.x,origin_y:this.y,width:0,height:0}}},{key:"collides",value:function(t){return t instanceof a?s.pointCollidesBox(this,t):t instanceof f?s.pointCollidesCircle(this,t):t instanceof e?s.pointCollidesPoint(this,t):t instanceof l?t.collides(this):s.circleCollidesPoint(this,t)}}]),e}();t.exports=y},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(3),s=n(0).Geometry,a=n(6),f=n(4),y=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,u(e).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"getCenter",value:function(){return{x:this.x,y:this.y}}},{key:"setCenter",value:function(t){this.x=t.x,this.y=t.y}},{key:"getContainingRectangle",value:function(){return{origin_x:this.x-this.radius,origin_y:this.y-this.radius,width:2*this.radius,height:2*this.radius}}},{key:"collides",value:function(t){return t instanceof a?s.circleCollidesBox(this,t):t instanceof e?s.circleCollidesCircle(this,t):t instanceof f?s.circleCollidesPoint(this,t):t instanceof l?t.collides(this):s.circleCollidesPoint(this,t)}}]),e}();t.exports=y},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(3),s=n(0).Geometry,a=n(5),f=n(4),y=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,u(e).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"getCenter",value:function(){return{x:this.origin_x+this.width/2,y:this.origin_y+this.height/2}}},{key:"setCenter",value:function(t){this.origin_x=t.x-this.width/2,this.origin_y=t.y-this.height/2}},{key:"setCenterWithinBounding",value:function(t,e){var n=e.getContainingRectangle(),o=this.getContainingRectangle(),i=t.x,r=t.y;n.width<o.width?i=e.getCenter().x:(i=Math.min(t.x,n.origin_x+n.width-o.width/2),i=Math.max(i,n.origin_x+o.width/2)),n.height<o.height?r=e.getCenter().y:(r=Math.min(t.y,n.origin_y+n.height-o.height/2),r=Math.max(r,n.origin_y+o.height/2)),this.setCenter({x:i,y:r})}},{key:"getContainingRectangle",value:function(){return{origin_x:this.origin_x,origin_y:this.origin_y,width:this.width,height:this.height}}},{key:"collides",value:function(t){return t instanceof e?s.boxCollidesBox(this,t):t instanceof a?s.boxCollidesCircle(this,t):t instanceof f?s.boxCollidesPoint(this,t):t instanceof l?t.collides(this):s.boxCollidesPoint(this,t)}}]),e}();t.exports=y},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(1),s=n(0).Constants,a=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=r(this,u(e).call(this,t)),t=Object.assign({direction:0,speed:0},t),n.__direction=t.direction,n.__speed=t.speed,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"getDirection",value:function(){return this.__direction}},{key:"getSpeed",value:function(){return this.__speed}},{key:"setDirection",value:function(t){this.__direction=t}},{key:"setSpeed",value:function(t){this.__speed=t}},{key:"rotateTowards",value:function(t,e){var n=this.getDirection(),o=(t+s.TAU-n)%s.TAU;e=e||1,o<=Math.PI?this.setDirection(n+o/e):this.setDirection(n-(o-Math.PI)/e)}}]),e}();t.exports=a},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(2),s=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,u(e).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"draw",value:function(t,e,n,o,i,r){var u=t.getContext("2d");u.beginPath(),u.arc(e,n,20,0,2*Math.PI,!1),u.fillStyle="grey",u.fill(),u.lineWidth=5,u.strokeStyle="#333333",u.stroke()}}]),e}();t.exports=s},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(1),s=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=r(this,u(e).call(this,t)),t=Object.assign({color:"transparent"},t),n._color=t.color,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"draw",value:function(t){var e=t.getCanvas(),n=t.getBounding().getContainingRectangle(),o=e.getContext("2d");o.beginPath(),o.fillStyle=this._color,o.fillRect(0,0,n.width,n.height),o.fill(),o.stroke()}}]),e}();t.exports=s},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function c(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var s=n(4),a=n(0).Geometry,f=function(t){function e(t,n){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o=i(this,r(e).call(this,t,n));for(var u=t.target,c=0,l=0;u&&!isNaN(u.offsetLeft)&&!isNaN(u.offsetTop);)c+=u.offsetLeft-u.scrollLeft,l+=u.offsetTop-u.scrollTop,u=u.offsetParent;if(o._super("initialize",{x:t.clientX-c,y:t.clientY-l}),n){o.world_x=o.x+n.getBounding().origin_x,o.world_y=o.y+n.getBounding().origin_y;var s=n.getCanvas().getBoundingClientRect();o.device_x=o.x+s.left,o.device_y=o.y+s.top}return o.timestamp=Date.now(),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(e,s),c(e,null,[{key:"EVENT_TYPES",get:function(){return{TAP:"tap",DOUBLE:"doubletap",LONG:"longtap",MOVE:"mousemove",UP:"mouseup",DOWN:"mousedown"}}}]),c(e,[{key:"linkEvent",value:function(t){return t instanceof e&&(this.linked_event=t,this.velocity=a.pointToPoint(this.linked_event,this)),this}},{key:"setType",value:function(t){if(-1===e.EVENT_TYPES.values().indexOf(t))throw"Invalid event type";return this.type=t,this}},{key:"getType",value:function(){return this.type?this.type:null}}]),e}();t.exports=f},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var l=n(10),s=n(0).Geometry,a=n(2),f=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=function(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?c(t):e}(this,r(e).call(this,t))).__view=t.view,t=Object.assign({bounding:n.__view.getBounding(),double:300,tap:300,tap_distance:20},t),n.setBounding(t.bounding),n._doubleTapThreshold=t.double,n._tapThreshold=t.tap,n._tapDistanceThreshold=t.tap_distance,n._longTapCancel=2*n._tapThreshold,t.absolute&&(n.__boundToWorld=!0),n._lastUp=null,n._lastDown=null,n._lastMove=null,l.EVENT_TYPES.forEach(function(t){n.__getListenersByType.call(c(c(n)),t)}),n.__id=null,n.__key=0,n.__isDown=!1;var i=c(c(n));return n.__view.getCanvas().addEventListener("mousedown",function(t){i._handleDown.apply(i,arguments)},!1),n.__view.getCanvas().addEventListener("touchstart",function(t){t.preventDefault(),i._handleDown.apply(i,arguments)},!1),n.__view.getCanvas().addEventListener("mouseup",function(t){i._handleUp.apply(i,arguments)},!1),n.__view.getCanvas().addEventListener("touchend",function(t){t.preventDefault(),i._handleUp.apply(i,arguments)},!1),n.__view.getCanvas().addEventListener("mousemove",function(t){i._handleMove.apply(i,arguments)},!1),n.__view.getCanvas().addEventListener("touchmove",function(t){t.preventDefault(),i._handleMove.apply(i,arguments)},!1),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,a),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"draw",value:function(){this.getAppearance()&&this.getAppearance().draw(this.__view.getCanvas(),this.getBounding().getCenter().x,this.getBounding().getCenter().y,this.__view.getRotation(),this.__view.getScale(),this)}},{key:"setAppearance",value:function(t){this.__appearance=t}},{key:"getAppearance",value:function(t){return this.__appearance}},{key:"_handleDown",value:function(t){var e=this.__formatTouchEvent(t);e&&(e.setType(l.EVENT_TYPES.DOWN),this.__isDown=!0,this.__lastDown=e,this.__fireEvent(e))}},{key:"_handleUp",value:function(t){var e=this.__formatTouchEvent(t);if(e&&this.isDown()){var n=!1;if(this.__lastUp&&this.__lastUp.type==l.EVENT_TYPES.TAP&&this.__lastUp.timestamp-e.timestamp<=this._doubleTapThreshold&&(e.setType(l.EVENT_TYPES.DOUBLE),n=!0),!n&&this.__lastDown&&s.distanceToPoint(this.__lastDown,e)<this._tapDistanceThreshold){var o=e.timestamp-this.__lastDown.timestamp;o<=this._tapThreshold?(e.setType(l.EVENT_TYPES.TAP),n=!0):o<=this._longTapCancel&&(e.setType(l.EVENT_TYPES.LONG),n=!0)}n||e.setType(l.EVENT_TYPES.UP),e.linkEvent(this.__lastDown),this.__lastUp=e,this.__fireEvent(e),this.__isDown=!1}}},{key:"_handleMove",value:function(t){if(this.isDown()){var e=this.__formatTouchEvent(t);e&&(e.timestamp-this.__lastDown.timestamp<=this._longTapCancel&&s.distanceToPoint(this.__lastDown,e)<this._tapDistanceThreshold||(e.setType(l.EVENT_TYPES.MOVE),e.linkEvent(this.__lastMove),this.__lastMove=e,this.__fireEvent(e)))}}},{key:"__fireEvent",value:function(t){var e=this.__getListenersByType(t.getType());if(e.length)for(var n=0;n<e.length;n++)e[n].callback(t)}},{key:"__queueHistory",value:function(t,e){return t[0]=t[0].toUpperCase(),this["__last"+t].push(e),this["__last"+t].shift(),null}},{key:"__formatListener",value:function(t){return{key:++this.__key,callback:t}}},{key:"__formatTouchEvent",value:function(t){var e=t.changedTouches?t.changedTouches:[];if(e.length){var n=!1,o=0;do{if(!(o<e.length))return!1;t.clientX=e[o].clientX,t.clientY=e[o].clientY,n=new l(t,this.__view),o++}while(!this.collides(n))}else if(event=new l(t,this.__view),!this.collides(event))return!1;return event}},{key:"__getListenersByType",value:function(t){if(!t)return null;var e="__"+t+"Listeners";return this[e]||(this[e]=[]),this[e]}},{key:"__on",value:function(t,e){this.__getListenersByType(t).push(this.__formatListener(e))}},{key:"__off",value:function(t,e){for(var n=this.__getListenersByType(t),o=0;o<n.length;o++)n[o].callback===e&&delete n[o]}},{key:"onDouble",value:function(t){this.__on(l.EVENT_TYPES.DOUBLE,t)}},{key:"offDouble",value:function(t){this.__off(l.EVENT_TYPES.DOUBLE,t)}},{key:"onLong",value:function(t){this.__on(l.EVENT_TYPES.LONG,t)}},{key:"offLong",value:function(t){this.__off(l.EVENT_TYPES.LONG,t)}},{key:"onTap",value:function(t){this.__on(l.EVENT_TYPES.TAP,t)}},{key:"offTap",value:function(t){this.__off(l.EVENT_TYPES.TAP,t)}},{key:"onDown",value:function(t){this.__on(l.EVENT_TYPES.DOWN,t)}},{key:"offDown",value:function(t){this.__off(l.EVENT_TYPES.DOWN,t)}},{key:"onMove",value:function(t){this.__on(l.EVENT_TYPES.MOVE,t)}},{key:"offMove",value:function(t){this.__off(l.EVENT_TYPES.MOVE,t)}},{key:"onUp",value:function(t){this.__on(l.EVENT_TYPES.UP,t)}},{key:"offUp",value:function(t){this.__off(l.EVENT_TYPES.UP,t)}},{key:"isDown",value:function(){return this.__isDown}}]),e}();t.exports=f},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(8),s=n(5),a=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t={bounding:new s({x:0,y:0,radius:20})};return r(this,u(e).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"draw",value:function(t,e,n,o,i,r){var u=r.getDrawOptions(),c=t.getContext("2d");u.operating&&(c.beginPath(),c.arc(e,n,160,0,2*Math.PI,!1),c.fillStyle="rgba(0,255,0,0.1)",c.fill(),c.lineWidth=3,c.strokeStyle="rgba(0,255,0,0.3)",c.stroke()),c.beginPath(),c.arc(e,n,20,0,2*Math.PI,!1),c.fillStyle="#000000",c.fill(),c.lineWidth=5,c.strokeStyle="#303030",c.stroke(),c.beginPath(),c.lineWidth=18,c.strokeStyle="#333333",c.lineCap="round",c.moveTo(u.stick.x,u.stick.y),c.lineTo(e,n),c.stroke(),c.beginPath(),c.arc(u.stick.x,u.stick.y,18,0,2*Math.PI,!1),c.fillStyle="#dd2222",c.fill(),c.lineWidth=5,c.strokeStyle="#aa1111",c.stroke(),c.beginPath(),c.arc(u.stick.x+6,u.stick.y-6,4,0,2*Math.PI,!1),c.fillStyle="#ffcccc",c.fill()}}]),e}();t.exports=a},function(t,e,n){var o=n(3),i=n(4),r=n(5),u=n(6),c=n(8),l=n(9),s=n(14),a=n(15),f=n(2),y=n(16),p=n(17),_=n(1),h=n(7),b={Bounding:o,BoundingBox:u,BoundingCircle:r,BoundingPoint:i,Appearance:c,Background:l,Entity:s,Game:a,Generic:f,ParticleEmitter:p,Particle:y,Root:_,World:n(18),Vector:h},d=n(0),v=d.Functions,g=d.Geometry,m={Functions:v,Constants:d.Constants,Geometry:g},w={Event:n(10),Touch:n(11),Joystick:n(19)},O=n(12);TwoCylinder={Engine:b,IO:w,Sprites:{Josystick:O},Utilities:m},t.exports=TwoCylinder},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(2),s=n(8),a=n(7),f=n(4),y=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=r(this,u(e).call(this,t))).__appearance=null,(t=Object.assign({velocity:null,rotation:0,rotation_lag:20},t)).appearance&&n.setAppearance(t.appearance),n._velocity=t.velocity,n._rotationLag=t.rotation_lag,n._rotation=t.rotation,n._collisionGroup="ENTITY",n.__id=null,n.__collisionGroupListening={},n.__visible=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"draw",value:function(t,e,n){this.getAppearance().draw(t.getCanvas(),e,n,t.getRotation()*this._rotation,t.getScale(),this)}},{key:"preStep",value:function(t){}},{key:"step",value:function(t){this.getSpeed()&&(this.getBounding().setCenter({x:this.getBounding().getCenter().x+this.getSpeed()*Math.cos(this.getDirection()),y:this.getBounding().getCenter().y+this.getSpeed()*Math.sin(this.getDirection())}),this.getAppearance()&&this.getAppearance().getBounding().setCenter(this.getBounding().getCenter()))}},{key:"postStep",value:function(t){}},{key:"getCollisionGroup",value:function(){return this._collisionGroup}},{key:"getCollidableGroups",value:function(){return Object.keys(this.__collisionGroupListening)}},{key:"handleCollidedWith",value:function(t){var e=this.objectIsCollidable(t);e&&e.apply(this,[t])}},{key:"groupIsCollidable",value:function(t){var e=!1;return this.__collisionGroupListening[other]&&(e=this.__collisionGroupListening[other]),e}},{key:"objectIsCollidable",value:function(t){return t instanceof e&&this.groupIsCollidable(t.getCollisionGroup())}},{key:"hasCollisionChecking",value:function(){return this.__collisionGroupListening.hasOwnProperty}},{key:"onCollideGroup",value:function(t,e){this.__collisionGroupListening[t]=e}},{key:"offCollideGroup",value:function(t){delete this.__collisionGroupListening[t]}},{key:"getPosition",value:function(){return this.getBounding().getCenter()}},{key:"setPosition",value:function(t,e){t instanceof f?this.getBounding().updateBounding(t.getCenter()):"object"===o(t)?this.getBounding().updateBounding({x:t.x,y:t.y}):this.getBounding().updateBounding(t,e)}},{key:"setAppearance",value:function(t){if(!(t instanceof s))throw"Appearance must be a instance of Appearance";this.__appearance=t}},{key:"getAppearance",value:function(){return this.__appearance}},{key:"getDirection",value:function(){return this.getVelocity().getDirection()}},{key:"rotateTowards",value:function(t){this.getVelocity().rotateTowards(t,this._rotationLag)}},{key:"setDirection",value:function(t){return this.getVelocity().setDirection(t),this.getDirection()}},{key:"getSpeed",value:function(){return this.getVelocity().getSpeed()}},{key:"setSpeed",value:function(t){this.getVelocity().setSpeed(t)}},{key:"setVelocity",value:function(t){this._velocity=t}},{key:"getVelocity",value:function(){return this._velocity||(this._velocity=new a),this._velocity}},{key:"getVisible",value:function(){return this.isVisible()}},{key:"isVisible",value:function(){return this.__id&&this.__visible&&!!this.__appearance}},{key:"setVisible",value:function(t){this.__visible=t}}]),e}();t.exports=y},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(1),s=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=r(this,u(e).call(this))).__world=void 0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"start",value:function(){return this.getWorld().start()}},{key:"exit",value:function(){return this.getWorld().exit()}},{key:"setWorld",value:function(t){this.__world=t}},{key:"getWorld",value:function(){return this.__world}}]),e}();t.exports=s},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(1),s=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=r(this,u(e).call(this,t)),t=Object.assign({},t),n.__id=t.id,n.__emitter=t.emitter,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"step",value:function(t){return null}},{key:"draw",value:function(t,e,n,o,i,r){var u=t.getContext("2d");u.beginPath(),u.arc(e,n,20,0,2*Math.PI,!1),u.fillStyle="grey",u.fill(),u.lineWidth=5,u.strokeStyle="#333333",u.stroke()}},{key:"destroy",value:function(){this.__emitter.removeParticle(this)}}]),e}();t.exports=s},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(0).Functions,s=n(2),a=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=r(this,u(e).call(this,t))).__particles=[],n.__toRemove=[],n.__isEmitting=!1,n.__particleKey=0,n.__id=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,s),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"draw",value:function(t,e,n){var o=this;this.getParticles().forEach(function(i){i.draw(t.getCanvas(),e,n,t.getRotation()*o._rotation,t.getScale(),o)})}},{key:"step",value:function(t){this.getParticles().forEach(function(e){e.step(t)}),this.__removeParticles()}},{key:"destroy",value:function(){this.__particles=[]}},{key:"setIsEmitting",value:function(t){this.__isEmitting=t}},{key:"getIsEmitting",value:function(){return this.__isEmitting}},{key:"getParticles",value:function(){return this.__particles}},{key:"removeParticle",value:function(t){this.__toRemove.push(t)}},{key:"__removeParticles",value:function(t){l.disjoinArray2FromArray1(this.__particles,this.__toRemove),this.__toRemove=[]}},{key:"emitParticle",value:function(t,e){var n;return n=new t(e=Object.assign({id:++this.__particleKey,emitter:this},e)),this.__particles.push(n),n}}]),e}();t.exports=a},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(2),s=n(9),a=n(6),f=(n(0).Functions,function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t.bounding=new a({origin_x:0,origin_y:0,width:t.width,height:t.height}),(n=r(this,u(e).call(this,t)))._fps=t.fps||30,n.__instances=[],n.__particleEmitters=[],n.__views=[],n.__toRemoveParticleEmitters=[],n.__toRemoveInstances=[],n.__toRemoveViews=[],n.__collisionGroups={},n.__background=t.background||new s,n.__instanceKey=0,n.__viewKey=0,n.__emitterKey=0,n.__clock=0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"start",value:function(){var t=this;this.__intervalId=setInterval(function(){try{t.loop.apply(t,[])}catch(e){t.exit(e)}},1e3/this._fps)}},{key:"__preStep",value:function(t){this.__instances.forEach(function(e){e.preStep(t)})}},{key:"__postStep",value:function(t){this.__instances.forEach(function(e){e.postStep(t)}),this.__removeParticleEmitters(),this.__removeViews(),this.__removeInstances()}},{key:"loop",value:function(){var t=this;this.__preStep(++this.__clock),this.__particleEmitters.forEach(function(e){e.step(t.__clock)}),this.__instances.forEach(function(e){e.step(t.__clock)}),this.__instances.forEach(function(e){e.hasCollisionChecking()&&e.getCollidableGroups().forEach(function(n){t.__collisionGroups[n]&&t.__collisionGroups[n].length&&t.__collisionGroups[n].forEach(function(t){e.__id!==t.__id&&e.collides(t.getBounding())&&e.handleCollidedWith(t)})})}),this.__views.forEach(function(e){e.draw(t.__clock)}),this.__postStep(this.__clock)}},{key:"exit",value:function(){clearInterval(this.__intervalId)}},{key:"removeInstance",value:function(t){return t.__id&&this.__toRemoveInstances.push(t),t}},{key:"__removeInstances",value:function(){disjoinArray2FromArray1(this.__instances,this.__toRemoveInstances,this.__removeFromCollisionGroup),this.__toRemoveInstances=[]}},{key:"addInstance",value:function(t){if(t.__id)throw"Instance already added";return t.__id=++this.__instanceKey,this.__instances.push(t),this.__addToCollisionGroup(t),t}},{key:"getInstances",value:function(){return this.__instances}},{key:"addView",value:function(t){if(t.__id)throw"View already added";return t.__id=++this.__viewKey,t.setWorld(this),this.__views.push(t),t}},{key:"getViews",value:function(){return this.__views}},{key:"__removeViews",value:function(){disjoinArray2FromArray1(this.__views,this.__toRemoveViews),this.__toRemoveViews=[]}},{key:"removeView",value:function(t){return t.__id&&this.__toRemoveViews.push(t),t}},{key:"addParticleEmitter",value:function(t){if(t.__id)throw"Emitter already added";return t.__id=++this.__emitterKey,this.__particleEmitters.push(t),t}},{key:"removeParticleEmitter",value:function(t){return t.__id&&this.__toRemoveParticleEmitters.push(t),t}},{key:"__removeParticleEmitters",value:function(){disjoinArray2FromArray1(this.__particleEmitters,this.__toRemoveParticleEmitters),this.__toRemoveParticleEmitters=[]}},{key:"getParticleEmitters",value:function(){return this.__particleEmitters}},{key:"setBackground",value:function(t){this.__background=t}},{key:"getBackground",value:function(){return this.__background}},{key:"__addToCollisionGroup",value:function(t){var e=t.getCollisionGroup();this.__collisionGroups[e]||(this.__collisionGroups[e]=[]),this.__collisionGroups[e].push(t)}},{key:"__removeFromCollisionGroup",value:function(t){var e,n=t.getCollisionGroup();if(!this.__collisionGroups[n])throw"Collision Group does not exist";for(e=0;e<this.__collisionGroups[n].length;e++)if(this.__collisionGroups[n][e].__id===t.__id){this.__collisionGroups[n].splice(e,1);break}}}]),e}());t.exports=f},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=n(11),s=n(5),a=n(0),f=a.Geometry,y=a.Functions,p=n(12),_=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);return t.tap_distance=0,t.bounding=new s({x:t.x,y:t.y,radius:40}),(n=r(this,u(e).call(this,t)))._defaultRadius=40,n.__isHeld=!1,n.__pullRatio=1.8,n.__operateFunction=null,n.__appearance=new p,n._previousEvent=null,n.onDown(function(t){n._previousEvent=t,n._previousEvent.linkEvent(t),n.getBounding().updateBounding({radius:4*n._defaultRadius}),"function"==typeof n.__operateFunction&&(t.velocity&&t.velocity.setSpeed(0),n.__operateFunction(t))}),n.onUp(function(t){n.getBounding().updateBounding({radius:n._defaultRadius}),delete n._previousEvent,"function"==typeof n.__operateFunction&&(t.velocity&&t.velocity.setSpeed(0),n.__operateFunction(t))}),n.onMove(function(t){n.isDown()&&(t.linkEvent(n.__lastDown),"function"==typeof n.__operateFunction&&(t.velocity&&t.velocity.setSpeed(Math.min(t.velocity.getSpeed(),n._defaultRadius/n.__pullRatio)),n.__operateFunction(t)),n._previousEvent=t)}),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,l),function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"onOperate",value:function(t){this.__operateFunction=t}},{key:"offOperate",value:function(){delete this.__operateFunction}},{key:"getDrawOptions",value:function(){var t={stick:this.getBounding().getCenter(),operating:this.isDown()};if(this._previousEvent&&this._previousEvent.velocity){var e=y.clone(this._previousEvent.velocity);e.setSpeed(Math.min(this._defaultRadius/this.__pullRatio,this._previousEvent.velocity.getSpeed())),t.stick=f.pointFromVector(t.stick,e)}return t}}]),e}();t.exports=_}])});